# プレミアム機能・マネタイズ実装計画

- [x] 1. 基盤システムのセットアップ

  - NextAuth.js 認証システムの設定とユーザー管理機能の実装
  - SQLite データベースの初期化とテーブル作成
  - 環境変数の設定とセキュリティ設定の実装
  - _要件: 1.1, 1.2_

- [x] 2. ユーザー認証機能の実装
- [x] 2.1 認証コンポーネントの作成

  - ログイン・サインアップフォームコンポーネントの実装
  - ユーザーメニューとセッション管理の実装
  - 認証状態に基づくナビゲーション制御の実装
  - _要件: 1.1, 1.2_

- [x] 2.2 認証 API エンドポイントの実装

  - NextAuth.js 設定とプロバイダー設定の実装
  - ユーザープロフィール管理 API の実装
  - セッション検証とミドルウェアの実装
  - _要件: 1.1, 1.2_

- [x] 3. Stripe 決済システムの統合
- [x] 3.1 Stripe 設定と Checkout 機能の実装

  - Stripe 設定とプレミアムプラン商品の作成
  - Checkout セッション作成 API の実装
  - 決済成功・失敗時のリダイレクト処理の実装
  - _要件: 1.3_

- [x] 3.2 サブスクリプション管理機能の実装

  - Stripe Webhook エンドポイントの実装
  - サブスクリプション状態同期機能の実装
  - キャンセル・再開機能の実装
  - _要件: 1.3, 1.4_

- [x] 4. プレミアム機能アクセス制御の実装
- [x] 4.1 プレミアム機能チェックミドルウェアの作成

  - ユーザーのサブスクリプション状態確認機能の実装
  - プレミアム機能へのアクセス制御ロジックの実装
  - 無料ユーザー向けアップグレード案内の実装
  - _要件: 2.3, 3.3, 4.4, 5.4, 6.3, 7.4_

- [x] 4.2 検索制限機能の実装

  - 無料ユーザーの検索回数カウント機能の実装
  - 月次リセット機能とスケジューラーの実装
  - 検索制限到達時の案内表示の実装
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [-] 5. お気に入り機能の実装
- [x] 5.1 お気に入りデータ管理の実装

  - お気に入り追加・削除 API エンドポイントの実装
  - お気に入り一覧取得機能の実装
  - 食材・レシピ両対応のデータ構造実装
  - _要件: 2.1, 2.2, 2.4_

- [x] 5.2 お気に入り UI コンポーネントの実装

  - お気に入りボタンコンポーネントの実装
  - お気に入り一覧ページの実装
  - プレミアム限定表示とアップグレード案内の実装
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [-] 6. 簡易栄養計算機能の実装
- [x] 6.1 栄養計算ロジックの実装

  - 複数食材の栄養価合計計算機能の実装
  - 年齢・性別別推奨摂取量データの実装
  - 栄養バランス比較表示機能の実装
  - _要件: 5.1, 5.2, 5.3_

- [x] 6.2 栄養計算 UI の実装

  - 栄養計算機コンポーネントの実装
  - 食材選択・数量入力インターフェースの実装
  - 計算結果表示とグラフ機能の実装
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [-] 7. PDF 保存機能の実装
- [x] 7.1 PDF 生成システムの実装

  - jsPDF と html2canvas を使用した PDF 生成機能の実装
  - レシピ情報の整理とレイアウト設計の実装
  - 個人メモ追加機能の実装
  - _要件: 6.1, 6.2, 6.4_

- [x] 7.2 PDF 保存 UI の実装

  - PDF 保存ボタンコンポーネントの実装
  - メモ入力ダイアログの実装
  - プレミアム限定機能の案内表示の実装
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [-] 8. 買い物リスト機能の実装
- [x] 8.1 買い物リストデータ管理の実装

  - 買い物リスト追加・編集・削除 API の実装
  - レシピからの食材自動追加機能の実装
  - チェック状態管理機能の実装
  - _要件: 7.1, 7.2, 7.3_

- [x] 8.2 買い物リスト UI の実装

  - 買い物リスト表示・編集コンポーネントの実装
  - レシピページからの追加ボタンの実装
  - チェックリスト機能とプログレス表示の実装
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [-] 9. 広告システムの実装
- [x] 9.1 Google AdSense 統合の実装

  - AdSense コンポーネントの実装
  - 広告表示・非表示制御ロジックの実装
  - レスポンシブ広告配置の実装
  - _要件: 4.1, 4.2_

- [x] 9.2 アフィリエイト広告の実装

  - 楽天・Amazon アフィリエイトリンク生成機能の実装
  - 食材カテゴリ別関連商品推奨システムの実装
  - ネイティブ広告コンポーネントの実装
  - _要件: 4.3, 4.4_

- [-] 10. プレミアム機能統合と UI 改善
- [x] 10.1 プレミアム機能の統合

  - 既存ページへのプレミアム機能統合
  - プレミアム限定機能の表示・非表示制御
  - アップグレード案内の統一デザイン実装
  - _要件: 全プレミアム機能要件_

- [x] 10.2 料金プランページの実装

  - 料金プラン比較ページの実装
  - 機能比較表と CTA ボタンの実装
  - 7 日間無料トライアル案内の実装
  - _要件: 1.3_

- [-] 11. テストとセキュリティ
- [x] 11.1 認証・決済機能のテスト実装

  - 認証フローの単体・統合テストの実装
  - Stripe 決済のテストモード検証の実装
  - セキュリティ脆弱性テストの実装
  - _要件: 全要件の品質保証_

- [x] 11.2 プレミアム機能の E2E テスト実装

  - プレミアム機能のユーザーフローテストの実装
  - アクセス制御のテストケース実装
  - 広告表示・非表示のテスト実装
  - _要件: 全要件の品質保証_

- [x] 12. 本番環境準備とデプロイ
- [x] 12.1 本番環境設定の実装

  - 環境変数とシークレット管理の設定
  - データベースマイグレーション機能の実装
  - 監視・ログ機能の設定
  - _要件: 全要件の本番運用_

- [x] 12.2 パフォーマンス最適化と監視
  - データベースクエリ最適化の実装
  - KPI 追跡とアナリティクス設定の実装
  - エラー監視とアラート設定の実装
  - _要件: 全要件の運用品質_
